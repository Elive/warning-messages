#!/bin/bash
source /usr/lib/elive-tools/functions
#el_make_environment
. gettext.sh
TEXTDOMAIN="warning-messages"
export TEXTDOMAIN
el_check_translations_required_notify

WARN_DIR="$HOME/.elive/warning_messages"
cancel_ok_message="\n\n""$( eval_gettext "如果你不想再次收到这条提示，请点击“No"。" )"
guitool=zenity

if [[ -z "$1" ]] ; then
    #echo -e "Usage: $(basename $0) message-type number-times-to-appear"
    echo -e "Usage: $(basename $0) message-type"
    exit 1
fi

if ! [[ -d "$WARN_DIR" ]] ; then
    mkdir -p "$WARN_DIR"
fi


#-------------------------------------------------------------------------------
#   Check control: show the message only if we need to show it
#-------------------------------------------------------------------------------
check_control(){
    # return true only if want need to show this message
    if [[ -f "${WARN_DIR}/${id}" ]] ; then
        return 1
    else
        return 0
    fi
}

#-------------------------------------------------------------------------------
#   Add control: if the user has press Cancel: create the file
#-------------------------------------------------------------------------------
add_control(){
    # file is created, the popup should not appear anymore
    touch "${WARN_DIR}/${id}"
}

#-------------------------------------------------------------------------------
#   Send message: send message and manage control
#-------------------------------------------------------------------------------
send_message(){
    # send message ($1 input), add the footer, and if the user click in Cancel then we dont show it anymore
    $guitool --question --text="$1""${cancel_ok_message}" || add_control "$id"
}


#-------------------------------------------------------------------------------
#   Message: Ecomorph
#-------------------------------------------------------------------------------
message_ecomorph(){
    check_control "$id" || exit 0
    send_message "$( eval_gettext "注意：使用该功能，你可能会遇到一些问题，如窗口丢失或窗口定位错误，桌面环境更加不稳定，窗口消失，窗口不能点击，视频卡顿等，该功能是实验性的且为完成。你已经知道了可能会出现什么问题，欢迎使用。" )" "$id"
}

#-------------------------------------------------------------------------------
#   Message: Suspend
#-------------------------------------------------------------------------------
message_suspend(){
    check_control "$id" || exit 0
    send_message "$( eval_gettext "警告：挂起和休眠 可能会产生一些问题，如硬件无响应，尤其当你恢复系统时。重启计算机可以解决问题。请在有预防措施的情况下使用这些功能！如果你的硬件不能正常支持挂起功能，请不要使用。" )" "$id"
}

#-------------------------------------------------------------------------------
#   Message: Compatibility of package not installed
#-------------------------------------------------------------------------------
message_compat_notinstalled(){
    check_control "$id" || exit 0

    local translated_message
    translated_message="$( printf "$( eval_gettext "注意：你的系统尝试运行程序<b>%s<b>," )" "$@" )"

    send_message "$translated_message" "$id"
}
#-------------------------------------------------------------------------------
#   Message: NTFS crappy
#-------------------------------------------------------------------------------
message_ntfs_is_crap(){
    check_control "$id" || exit 0
    send_message "$( eval_gettext "警告：你正在使用一个Microdoft NTFS分区，短期使用没问题，但如果想长期使用你必须知道它可能是不稳定的。它可能是你计算机无法使用或者数据丢失，这些问题产生的原因是Microsoft更改NTFS文件系统内在工作机制而不发布任何信息，以至于其他操作系统如linux和mac不能使用。这是因为Microsoft系统并非开源或者是他们使用垄断策略。这条信息旨在告诉你，如果你在使用NTFS文件系统的过程中遇到问题，那是Microsoft的错而非我们，所以，请不要提交NTFS相关的bug给我们。最后，作为提醒，如果你想在不同的操作系统之间交换数据，请使用fat32代替，它运行的很稳定，而且任何流行的操作系统均对fat32提供支持。" )" "$id"
}



#-------------------------------------------------------------------------------
#   MAIN
#-------------------------------------------------------------------------------
id="$1"
shift

case $id in
    compiz|ecomorph)
        message_ecomorph "$@"
        ;;
    hibernate|suspend|hebernate)
        message_suspend "$@"
        ;;
    compat_notinstalled)
        message_compat_notinstalled "$@"
	;;
    ntfs_is_crap)
	message_ntfs_is_crap "$@"
        ;;
    *)
        el_explain 2 "not found any message mode to use called '$@' for $(basename $0)"
        ;;
esac

